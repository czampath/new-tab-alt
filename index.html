<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Tab</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300..600&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        input, textarea {
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }

        @keyframes fadeInUp {
            0% {
                opacity: 0;
                transform: translateY(20px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes popIn {
            0% {
                opacity: 0;
                transform: scale(0.92) translateY(10px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @keyframes modalFadeIn {
            0% {
                opacity: 0;
            }
            100% {
                opacity: 1;
            }
        }

        @keyframes modalPopIn {
            0% {
                opacity: 0;
                transform: scale(0.94) translateY(8px);
            }
            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        @keyframes modalFadeOut {
            0% {
                opacity: 1;
            }
            100% {
                opacity: 0;
            }
        }

        @keyframes modalPopOut {
            0% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
            100% {
                opacity: 0;
                transform: scale(0.94) translateY(8px);
            }
        }

        body {
            font-family: 'Roboto', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            color: #fff;
        }

        #sparkCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            font-feature-settings: 'cv02', 'cv03', 'cv04', 'cv11';
            transition: color 0.6s ease;
        }

        .main-body {
            box-shadow: 0px 0px 15px 5px rgba(0,0,0,0.18) inset;
            /* -webkit-box-shadow: -2px -1px 9px 1px rgba(0,0,0,0.24) inset; */
            /* -moz-box-shadow: -2px -1px 9px 1px rgba(0,0,0,0.24) inset; */
        }

        #gradient-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            pointer-events: none;
            z-index: 0;
            transition: opacity 1.5s ease;
        }

        .container {
            max-width: 900px;
            width: 100%;
            position: relative;
            z-index: 1;
        }

        .time-display {
            text-align: center;
            margin-bottom: 40px;
            animation: fadeInUp 0.75s cubic-bezier(0.16, 1, 0.3, 1) 0.12s both;
        }

        .time {
            font-size: 72px;
            font-weight: 300;
            letter-spacing: -2px;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.2);
        }

        .date {
            font-size: 18px;
            opacity: 0.9;
            margin-top: 10px;
            font-family: 'Roboto', sans-serif;
            font-weight: 300;
            letter-spacing: 0.3px;
        }

        /* Debug meter - temporary */
        #debugMeter {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.6;
            z-index: 10000;
            min-width: 280px;
            width: fit-content;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        #debugMeter .meter-title {
            color: #fff;
            font-weight: bold;
            margin-bottom: 8px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }

        #debugMeter .meter-row {
            display: flex;
            justify-content: space-between;
            margin: 3px 0;
        }

        #debugMeter .meter-label {
            color: #aaa;
        }

        #debugMeter .meter-value {
            color: #0f0;
            font-weight: bold;
        }

        #debugMeter .meter-bar {
            margin-top: 8px;
            height: 20px;
            background: #222;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        #debugMeter .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #0f0, #0a0);
            transition: width 0.2s ease;
        }

        .weather {
            font-size: 16px;
            opacity: 0.9;
            margin-top: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .weather-icon {
            font-size: 24px;
        }

        .weather-temp {
            font-weight: 500;
        }

        .search-box {
            font-size: 16px;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0px 0px 5px 3px rgba(0, 0, 0, 0.24) inset;
            border-radius: 50px;
            padding: 0 25px;
            margin-bottom: 40px;
            /* box-shadow: 0 10px 40px rgba(0,0,0,0.15); */
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
            animation: fadeInUp 0.75s cubic-bezier(0.16, 1, 0.3, 1) 0.27s both;
            height: 54px;
        }

        .search-box:hover {
            box-shadow: 0px 0px 8px 3px rgba(0, 0, 0, 0.34) inset;
            transform: translateY(-1px);
        }

        /* .search-box:focus-within {
            box-shadow: 0px 0px 10px 4px rgba(0, 0, 0, 0.5) inset;
            transform: translateY(-2px);
        } */

        .search-box input {
            border: none;
            outline: none;
            flex: 1;
            font-size: 18px;
            font-weight: 300;
            background: transparent;
            color: #333;
            font-family: 'Roboto', sans-serif;
            letter-spacing: 0.3px;
            height: 100%;
            padding: 15px 0;
        }

        .search-box input::placeholder {
            color: #999;
            font-weight: 300;
        }

        .search-icon {
            color: #667eea;
            margin-right: 10px;
        }

        .bookmarks-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            animation: fadeInUp 0.75s cubic-bezier(0.16, 1, 0.3, 1) 0.42s both;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-header h2 {
            font-size: 19px;
            font-weight: 550;
            letter-spacing: -0.025em;
        }

        .add-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: #fff;
            padding: 0;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            font-weight: 300;
            line-height: 1;
            transition: all 0.3s ease, background 0.6s ease, color 0.6s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: popIn 0.65s cubic-bezier(0.34, 1.56, 0.64, 1) 0.65s both;
        }

        .add-btn:hover {
            background: rgba(255, 255, 255, 0.45);
            transform: translateY(-1px) scale(1.05);
        }

        body.light-theme .add-btn {
            background: rgba(0, 0, 0, 0.15);
            color: #333;
        }

        body.light-theme .add-btn:hover {
            background: rgba(0, 0, 0, 0.25);
        }

        .bookmarks-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .bookmark {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 18px 14px;
            text-align: center;
            text-decoration: none;
            color: #fff;
            transition: all 0.3s ease, background 0.6s ease, color 0.6s ease;
            position: relative;
            cursor: pointer;
            animation: popIn 0.65s cubic-bezier(0.34, 1.56, 0.64, 1) both;
        }

        .bookmark:nth-child(1) { animation-delay: 0.67s; }
        .bookmark:nth-child(2) { animation-delay: 0.74s; }
        .bookmark:nth-child(3) { animation-delay: 0.81s; }
        .bookmark:nth-child(4) { animation-delay: 0.88s; }
        .bookmark:nth-child(5) { animation-delay: 0.95s; }
        .bookmark:nth-child(6) { animation-delay: 1.02s; }
        .bookmark:nth-child(7) { animation-delay: 1.09s; }
        .bookmark:nth-child(8) { animation-delay: 1.16s; }
        .bookmark:nth-child(9) { animation-delay: 1.23s; }
        .bookmark:nth-child(10) { animation-delay: 1.30s; }
        .bookmark:nth-child(n+11) { animation-delay: 1.37s; }

        .bookmark:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
        }

        body.light-theme .bookmark {
            background: rgba(0, 0, 0, 0.1);
            color: #333;
        }

        body.light-theme .bookmark:hover {
            background: rgba(0, 0, 0, 0.15);
        }

        .bookmark-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }

        .bookmark-title {
            font-size: 13.5px;
            font-weight: 500;
            word-break: break-word;
            letter-spacing: -0.015em;
            line-height: 1.3;
        }

        .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: rgba(0, 0, 0, 0.4);
            border: none;
            color: #fff;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: none;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .delete-btn:hover {
            background: rgba(0, 0, 0, 0.6);
            transform: scale(1.1);
        }

        .bookmark:hover .delete-btn {
            display: flex;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(5px);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            animation: modalFadeIn 0.2s ease-out;
        }

        .modal.closing {
            display: flex;
            animation: modalFadeOut 0.2s ease-out;
        }

        .modal-content {
            background: #fff;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        .modal.active .modal-content {
            animation: modalPopIn 0.3s cubic-bezier(0.34, 1.3, 0.64, 1);
        }

        .modal.closing .modal-content {
            animation: modalPopOut 0.2s cubic-bezier(0.6, 0, 0.8, 0.4);
        }

        .modal-content h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 21px;
            font-weight: 600;
            letter-spacing: -0.03em;
            line-height: 1.2;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            color: #666;
            margin-bottom: 5px;
            font-size: 13.5px;
            font-weight: 500;
            letter-spacing: -0.01em;
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 400;
            font-family: 'Roboto', sans-serif;
            letter-spacing: -0.01em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .modal-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            font-family: 'Roboto', sans-serif;
            letter-spacing: -0.015em;
            transition: all 0.3s ease;
        }

        .modal-btn.primary {
            background: #667eea;
            color: #fff;
        }

        .modal-btn.primary:hover {
            background: #5568d3;
        }

        .modal-btn.secondary {
            background: #e0e0e0;
            color: #333;
        }

        .modal-btn.secondary:hover {
            background: #d0d0d0;
        }

        .settings-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: #fff;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            transition: background 0.6s ease, rotate 0.4s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 999;
            animation: popIn 0.65s cubic-bezier(0.34, 1.56, 0.64, 1) 0.55s both;
        }

        .settings-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            rotate: 67.5deg;
        }

        body.light-theme .settings-btn {
            background: rgba(0, 0, 0, 0.15);
        }

        body.light-theme .settings-btn:hover {
            background: rgba(0, 0, 0, 0.25);
        }

        .cog-icon {
            margin-top: -3px;
        }

        .settings-panel {
            position: fixed;
            top: 0;
            right: -350px;
            width: 350px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: -5px 0 30px rgba(0,0,0,0.2);
            transition: right 0.3s ease;
            z-index: 1001;
            padding: 30px;
            overflow-y: auto;
        }

        .settings-panel.active {
            right: 0;
        }

        .settings-panel h3 {
            color: #333;
            margin-bottom: 25px;
            font-size: 23px;
            font-weight: 600;
            letter-spacing: -0.035em;
            line-height: 1.2;
        }

        .setting-item {
            margin-bottom: 25px;
        }

        .setting-item label {
            display: block;
            color: #666;
            margin-bottom: 8px;
            font-size: 13.5px;
            font-weight: 500;
            letter-spacing: -0.012em;
        }

        .setting-item input[type="color"] {
            width: 100%;
            height: 50px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
        }

        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 26px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: 0.3s;
            border-radius: 26px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: #667eea;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        .toggle-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .color-presets {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .color-preset {
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
        }

        .color-preset:hover {
            transform: scale(1.05);
            border-color: #fff;
        }

        .bookmark-icon img {
            width: 32px;
            height: 32px;
            border-radius: 7px;
        }

        .hidden {
            display: none !important;
        }

        .guide-btn {
            width: 100%;
            padding: 12px;
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            color: #667eea;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            font-family: 'Roboto', sans-serif;
            letter-spacing: -0.015em;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .guide-btn:hover {
            background: rgba(102, 126, 234, 0.15);
            border-color: rgba(102, 126, 234, 0.4);
        }

        .guide-modal .modal-content {
            max-width: 500px;
        }

        .guide-content {
            color: #333;
        }

        .guide-content h4 {
            font-size: 18px;
            font-weight: 600;
            margin: 20px 0 12px 0;
            color: #333;
            letter-spacing: -0.02em;
        }

        .guide-content h4:first-child {
            margin-top: 0;
        }

        .guide-content p {
            font-size: 14px;
            line-height: 1.6;
            color: #666;
            margin-bottom: 10px;
        }

        .guide-content ol {
            margin: 10px 0;
            padding-left: 20px;
        }

        .guide-content li {
            font-size: 14px;
            line-height: 1.7;
            color: #666;
            margin-bottom: 8px;
        }

        .guide-content a {
            color: #667eea;
            text-decoration: none;
            word-break: break-all;
        }

        .guide-content a:hover {
            text-decoration: underline;
        }

        .guide-content .highlight {
            background: rgba(102, 126, 234, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #667eea;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
            cursor: text;
        }

        #toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.85);
            color: #fff;
            padding: 14px 20px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            font-family: 'Roboto', sans-serif;
            letter-spacing: -0.01em;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            z-index: 10000;
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.3s ease, transform 0.3s ease;
            pointer-events: none;
        }

        #toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        #catAnimation {
            position: fixed;
            bottom: -25px;
            right: 10%;
            width: 180px;
            height: 180px;
            z-index: 9999;
            pointer-events: none;
            transform: translateY(100%);
            cursor: grab;
            overflow: hidden;
        }

        /* Debug meter - toggle with Ctrl+Shift+D */
        #debugMeter {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: #0f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            line-height: 1.6;
            z-index: 10000;
            min-width: 280px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
            display: none;
        }

        #debugMeter .meter-title {
            color: #fff;
            font-weight: bold;
            margin-bottom: 8px;
            border-bottom: 1px solid #333;
            padding-bottom: 5px;
        }

        #debugMeter .meter-row {
            display: flex;
            justify-content: space-between;
            margin: 3px 0;
        }

        #debugMeter .meter-label {
            color: #aaa;
        }

        #debugMeter .meter-value {
            color: #0f0;
            font-weight: bold;
        }

        #debugMeter .meter-bar {
            margin-top: 8px;
            height: 20px;
            background: #222;
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        #debugMeter .meter-fill {
            height: 100%;
            background: linear-gradient(90deg, #0f0, #0a0);
            transition: width 0.2s ease;
        }

        @media (max-width: 600px) {
            .time {
                font-size: 48px;
            }
            
            .bookmarks-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
                gap: 15px;
            }
        }
    </style>
</head>
<body class="main-body">
    <!-- Spark Canvas for cursor friction effect -->
    <canvas id="sparkCanvas"></canvas>
    
    <!-- Debug Meter (Ctrl+Shift+D to toggle) -->
    <div id="debugMeter">
        <div class="meter-title">üê± CAT SUMMONING DEBUG (Ctrl+Shift+D)</div>
        <div class="meter-row">
            <span class="meter-label">Dangle Intensity:</span>
            <span class="meter-value" id="dangleValue">0.0</span>
        </div>
        <div class="meter-bar">
            <div class="meter-fill" id="dangleBar"></div>
        </div>
        <div class="meter-row">
            <span class="meter-label">Original Time:</span>
            <span class="meter-value" id="originalTime">--</span>
        </div>
        <div class="meter-row">
            <span class="meter-label">Reduced Time:</span>
            <span class="meter-value" id="reducedTime">--</span>
        </div>
        <div class="meter-row">
            <span class="meter-label">Time Saved:</span>
            <span class="meter-value" id="timeSaved">--</span>
        </div>
        <div class="meter-row">
            <span class="meter-label">Next Cat In:</span>
            <span class="meter-value" id="nextCatTime">--</span>
        </div>
    </div>

    <div id="toast"></div>
    <div id="gradient-overlay"></div>
    <div id="catAnimation"></div>
    <button class="settings-btn" id="settingsBtn"><span class="cog-icon">‚öôÔ∏è</span></button>

    <div class="settings-panel" id="settingsPanel">
        <h3>Settings</h3>
        
        <div class="setting-item">
            <label>Background Gradient</label>
            <div class="color-presets">
                <div class="color-preset" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);" data-gradient="linear-gradient(135deg, #667eea 0%, #764ba2 100%)"></div>
                <div class="color-preset" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);" data-gradient="linear-gradient(135deg, #f093fb 0%, #f5576c 100%)"></div>
                <div class="color-preset" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);" data-gradient="linear-gradient(135deg, #4facfe 0%, #00f2fe 100%)"></div>
                <div class="color-preset" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);" data-gradient="linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"></div>
                <div class="color-preset" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);" data-gradient="linear-gradient(135deg, #fa709a 0%, #fee140 100%)"></div>
                <div class="color-preset" style="background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);" data-gradient="linear-gradient(135deg, #30cfd0 0%, #330867 100%)"></div>
                <div class="color-preset" style="background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);" data-gradient="linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)"></div>
                <div class="color-preset" style="background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);" data-gradient="linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)"></div>
                <div class="color-preset" style="background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);" data-gradient="linear-gradient(135deg, #2c3e50 0%, #34495e 100%)"></div>
            </div>
        </div>

        <div class="setting-item">
            <div class="toggle-label">
                <label>Show Time & Date</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggleTime" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>

        <div class="setting-item">
            <div class="toggle-label">
                <label>Show Bookmarks</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggleBookmarks" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>

        <div class="setting-item">
            <div class="toggle-label">
                <label>Show Search Bar</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggleSearch" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>

        <div class="setting-item">
            <div class="toggle-label">
                <label>Show Weather</label>
                <label class="toggle-switch">
                    <input type="checkbox" id="toggleWeather" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>

        <div id="weatherConfig">
            <div class="setting-item">
                <label>OpenWeather API Key</label>
                <div class="form-group" style="margin-bottom: 8px;">
                    <input type="password" id="weatherApiKey" placeholder="Enter your API key" style="width: 100%; padding: 8px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 13px;">
                </div>
                <small style="color: #666; font-size: 11px; display: block; margin-bottom: 8px;">Get free key: <a href="https://openweathermap.org/api" target="_blank" style="color: #667eea;">openweathermap.org/api</a></small>
            </div>

            <div class="setting-item">
                <label>Weather Location</label>
                <div class="form-group" style="margin-bottom: 8px;">
                    <input type="text" id="weatherLat" placeholder="Latitude (e.g., 40.7128)" style="width: 100%; padding: 8px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 13px;">
                </div>
                <div class="form-group">
                    <input type="text" id="weatherLon" placeholder="Longitude (e.g., -74.0060)" style="width: 100%; padding: 8px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 13px;">
                </div>
                <button id="saveWeatherLocation" style="margin-top: 8px; padding: 8px 16px; background: #667eea; color: #fff; border: none; border-radius: 8px; cursor: pointer; font-size: 13px; width: 100%;">Save Location</button>
            </div>
        </div>

        <button class="guide-btn" id="guideBtn">üìñ How to Use</button>
    </div>

    <div class="container">
        <div class="time-display">
            <div class="time" id="time">00:00</div>
            <div class="date" id="date">Loading...</div>
            <div class="weather" id="weather"></div>
        </div>

        <div class="search-box">
            <span class="search-icon">üîç</span>
            <input type="text" id="searchInput" placeholder="Search Google or type a URL" autocomplete="off">
        </div>

        <div class="bookmarks-section">
            <div class="section-header">
                <h2>Quick Access</h2>
                <button class="add-btn" id="addBookmarkBtn">+</button>
            </div>
            <div class="bookmarks-grid" id="bookmarksGrid"></div>
        </div>
    </div>

    <div class="modal" id="bookmarkModal">
        <div class="modal-content">
            <h3>Add New Site</h3>
            <div class="form-group">
                <label for="bookmarkTitle">Title</label>
                <input type="text" id="bookmarkTitle" placeholder="My Site">
            </div>
            <div class="form-group">
                <label for="bookmarkUrl">URL</label>
                <input type="text" id="bookmarkUrl" placeholder="https://example.com">
            </div>
            <div class="modal-buttons">
                <button class="modal-btn secondary" id="cancelBtn">Cancel</button>
                <button class="modal-btn primary" id="saveBtn">Save</button>
            </div>
        </div>
    </div>

    <div class="modal guide-modal" id="guideModal">
        <div class="modal-content">
            <h3>How to Use</h3>
            <div class="guide-content">
                <h4>Setup Instructions</h4>
                <p>Replace your browser's default new tab with this lightweight, customizable page:</p>
                <ol>
                    <li>Install the Chrome extension: <a href="https://chromewebstore.google.com/detail/override-chromes-new-tab/blipilanfdpkfifjekjokjahpjnngifa" target="_blank">Override Chrome's New Tab</a></li>
                    <li>After installation, set the URL to: <span class="highlight">https://czampath.github.io/new-tab-alt/</span></li>
                    <li>Save and open a new tab to see your custom page!</li>
                </ol>

                <h4>Why Use This?</h4>
                <p>‚Ä¢ Bypass organization-enforced new tab pages<br>
                ‚Ä¢ Lightweight (~30MB) and fast performance<br>
                ‚Ä¢ Fully customizable with your own bookmarks and settings<br>
                ‚Ä¢ No data collection or privacy concerns</p>

                <h4>Features</h4>
                <p>‚Ä¢ Add custom bookmarks with Quick Access<br>
                ‚Ä¢ Choose from beautiful gradient backgrounds<br>
                ‚Ä¢ Optional weather display (requires free API key)<br>
                ‚Ä¢ Search Google or navigate directly from the search bar</p>
            </div>
            <div class="modal-buttons">
                <button class="modal-btn primary" id="guideCloseBtn">Got it!</button>
            </div>
        </div>
    </div>

    <script>
        // Toast notification function
        function showToast(message, duration = 3000) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }

        // Default bookmarks
        const defaultBookmarks = [
            { title: 'Gmail', url: 'https://mail.google.com' },
            { title: 'GitHub', url: 'https://github.com' }
        ];

        // Load bookmarks from localStorage or use defaults
        let bookmarks = JSON.parse(localStorage.getItem('bookmarks')) || defaultBookmarks;

        // Load settings from localStorage
        let settings = JSON.parse(localStorage.getItem('settings')) || {
            background: 'linear-gradient(135deg, #30cfd0 0%, #330867 100%)',
            showTime: true,
            showBookmarks: true,
            showSearch: true,
            showWeather: true,
            weatherLat: '',
            weatherLon: '',
            weatherApiKey: ''
        };

        // Function to sanitize and validate URLs
        function sanitizeUrl(url) {
            try {
                const parsed = new URL(url);
                if (parsed.protocol === 'http:' || parsed.protocol === 'https:') {
                    // Validate that hostname exists and is not empty
                    if (!parsed.hostname || parsed.hostname.length === 0) {
                        return 'about:blank';
                    }
                    // Validate that hostname has at least one dot (e.g., google.com) or is localhost
                    if (parsed.hostname !== 'localhost' && !parsed.hostname.includes('.')) {
                        return 'about:blank';
                    }
                    return url;
                } else if (parsed.protocol === 'file:') {
                    // Allow local file paths
                    return url;
                }
            } catch {
                return 'about:blank';
            }
            return 'about:blank';
        }

        // Function to escape HTML to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Function to get favicon URL
        function getFaviconUrl(url) {
            try {
                const domain = new URL(url).origin;
                return `https://www.google.com/s2/favicons?domain=${domain}&sz=64`;
            } catch {
                return '';
            }
        }

        // Weather functionality
        const WEATHER_CACHE_DURATION = 60 * 60 * 1000; // 1 hour in milliseconds

        function getWeatherFromCache() {
            const cached = localStorage.getItem('weatherCache');
            if (!cached) return null;
            
            try {
                const data = JSON.parse(cached);
                const now = Date.now();
                if (now - data.timestamp < WEATHER_CACHE_DURATION) {
                    return data.weather;
                }
            } catch {
                return null;
            }
            return null;
        }

        function cacheWeather(weatherData) {
            const cache = {
                weather: weatherData,
                timestamp: Date.now()
            };
            localStorage.setItem('weatherCache', JSON.stringify(cache));
        }

        async function fetchWeather(lat, lon) {
            if (!lat || !lon) return null;
            if (!settings.weatherApiKey) {
                console.warn('Weather API key not configured');
                return null;
            }
            
            try {
                const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${settings.weatherApiKey}&units=metric`;
                const response = await fetch(url);
                if (!response.ok) throw new Error('Weather fetch failed');
                const data = await response.json();
                
                const weatherData = {
                    temp: Math.round(data.main.temp),
                    description: data.weather[0].description,
                    icon: data.weather[0].icon,
                    location: data.name
                };
                
                cacheWeather(weatherData);
                return weatherData;
            } catch (error) {
                console.error('Weather error:', error);
                return null;
            }
        }

        function getWeatherEmoji(icon) {
            const iconMap = {
                '01d': '‚òÄÔ∏è', '01n': 'üåô',
                '02d': '‚õÖ', '02n': '‚òÅÔ∏è',
                '03d': '‚òÅÔ∏è', '03n': '‚òÅÔ∏è',
                '04d': '‚òÅÔ∏è', '04n': '‚òÅÔ∏è',
                '09d': 'üåßÔ∏è', '09n': 'üåßÔ∏è',
                '10d': 'üå¶Ô∏è', '10n': 'üåßÔ∏è',
                '11d': '‚õàÔ∏è', '11n': '‚õàÔ∏è',
                '13d': '‚ùÑÔ∏è', '13n': '‚ùÑÔ∏è',
                '50d': 'üå´Ô∏è', '50n': 'üå´Ô∏è'
            };
            return iconMap[icon] || 'üå°Ô∏è';
        }

        function updateWeatherDisplay(weatherData) {
            const weatherEl = document.getElementById('weather');
            if (!weatherData) {
                if (!settings.weatherApiKey) {
                    weatherEl.innerHTML = '<span style="opacity: 0.7; font-size: 13px;">Configure API key in settings</span>';
                } else {
                    weatherEl.innerHTML = '<span style="opacity: 0.7; font-size: 13px;">Set location in settings</span>';
                }
                return;
            }
            
            const emoji = getWeatherEmoji(weatherData.icon);
            const locationText = weatherData.location ? ` at ${weatherData.location}` : '';
            weatherEl.innerHTML = `
                <span class="weather-icon">${emoji}</span>
                <span class="weather-temp">${weatherData.temp}¬∞C</span>
                <span>${weatherData.description}${locationText}</span>
            `;
        }

        async function loadWeather() {
            if (!settings.showWeather) return;
            
            const cached = getWeatherFromCache();
            if (cached) {
                updateWeatherDisplay(cached);
                return;
            }
            
            if (settings.weatherLat && settings.weatherLon) {
                const weatherData = await fetchWeather(settings.weatherLat, settings.weatherLon);
                updateWeatherDisplay(weatherData);
            } else {
                updateWeatherDisplay(null);
            }
        }

        // Time and Date
        function updateTime() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('time').textContent = `${hours}:${minutes}`;
            
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            document.getElementById('date').textContent = now.toLocaleDateString('en-US', options);
        }
        
        updateTime();
        setInterval(updateTime, 1000);

        // Initialize weather
        loadWeather();

        // Render bookmarks (XSS-safe)
        function renderBookmarks() {
            const grid = document.getElementById('bookmarksGrid');
            grid.innerHTML = '';
            
            bookmarks.forEach((bookmark, index) => {
                const bookmarkEl = document.createElement('a');
                bookmarkEl.className = 'bookmark';
                bookmarkEl.href = sanitizeUrl(bookmark.url);
                
                // Create icon with image
                const iconSpan = document.createElement('span');
                iconSpan.className = 'bookmark-icon';
                const img = document.createElement('img');
                const faviconUrl = getFaviconUrl(bookmark.url);
                img.src = faviconUrl;
                img.alt = bookmark.title;
                img.onerror = function() {
                    this.parentElement.textContent = 'üåê';
                };
                iconSpan.appendChild(img);
                
                // Create title (using textContent to prevent XSS)
                const titleDiv = document.createElement('div');
                titleDiv.className = 'bookmark-title';
                titleDiv.textContent = bookmark.title;
                
                // Create delete button
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = '√ó';
                deleteBtn.addEventListener('click', (event) => deleteBookmark(event, index));
                
                bookmarkEl.appendChild(iconSpan);
                bookmarkEl.appendChild(titleDiv);
                bookmarkEl.appendChild(deleteBtn);
                grid.appendChild(bookmarkEl);
            });
        }

        // Delete bookmark
        function deleteBookmark(event, index) {
            event.preventDefault();
            event.stopPropagation();
            bookmarks.splice(index, 1);
            localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
            renderBookmarks();
        }

        // Modal handling
        const modal = document.getElementById('bookmarkModal');
        const addBtn = document.getElementById('addBookmarkBtn');
        const cancelBtn = document.getElementById('cancelBtn');
        const saveBtn = document.getElementById('saveBtn');

        function closeModal() {
            modal.classList.add('closing');
            modal.classList.remove('active');
            setTimeout(() => {
                modal.classList.remove('closing');
                clearForm();
            }, 200);
        }

        addBtn.addEventListener('click', () => {
            modal.classList.add('active');
            document.getElementById('bookmarkTitle').focus();
        });

        cancelBtn.addEventListener('click', () => {
            closeModal();
        });

        let modalMouseDownTarget = null;
        modal.addEventListener('mousedown', (e) => {
            if (e.target === modal) {
                modalMouseDownTarget = e.target;
            } else {
                modalMouseDownTarget = null;
            }
        });

        modal.addEventListener('mouseup', (e) => {
            if (modalMouseDownTarget === modal && e.target === modal) {
                closeModal();
            }
            modalMouseDownTarget = null;
        });

        saveBtn.addEventListener('click', () => {
            const title = document.getElementById('bookmarkTitle').value.trim();
            const url = document.getElementById('bookmarkUrl').value.trim();

            if (title && url) {
                // Format URL: if it starts with http/https/file, use as-is; otherwise add https://
                let formattedUrl;
                if (url.startsWith('http://') || url.startsWith('https://') || url.startsWith('file://')) {
                    formattedUrl = url;
                } else {
                    formattedUrl = `https://${url}`;
                }
                
                const sanitized = sanitizeUrl(formattedUrl);
                
                if (sanitized === 'about:blank') {
                    showToast('Please enter a valid URL (e.g., google.com, http://example.com, or file:///path/to/file)');
                    return;
                }
                
                bookmarks.push({ title, url: sanitized });
                localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
                renderBookmarks();
                closeModal();
            }
        });

        // Handle Enter key in bookmark modal inputs
        document.getElementById('bookmarkTitle').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                saveBtn.click();
            }
        });

        document.getElementById('bookmarkUrl').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                saveBtn.click();
            }
        });

        function clearForm() {
            document.getElementById('bookmarkTitle').value = '';
            document.getElementById('bookmarkUrl').value = '';
        }

        // Guide modal handling
        const guideModal = document.getElementById('guideModal');
        const guideBtn = document.getElementById('guideBtn');
        const guideCloseBtn = document.getElementById('guideCloseBtn');

        function closeGuideModal() {
            guideModal.classList.add('closing');
            guideModal.classList.remove('active');
            setTimeout(() => {
                guideModal.classList.remove('closing');
            }, 200);
        }

        guideBtn.addEventListener('click', () => {
            guideModal.classList.add('active');
        });

        guideCloseBtn.addEventListener('click', () => {
            closeGuideModal();
        });

        let guideModalMouseDownTarget = null;
        guideModal.addEventListener('mousedown', (e) => {
            if (e.target === guideModal) {
                guideModalMouseDownTarget = e.target;
            } else {
                guideModalMouseDownTarget = null;
            }
        });

        guideModal.addEventListener('mouseup', (e) => {
            if (guideModalMouseDownTarget === guideModal && e.target === guideModal) {
                closeGuideModal();
            }
            guideModalMouseDownTarget = null;
        });

        // ESC key handler for modals and settings panel
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                // Close bookmark modal if active
                if (modal.classList.contains('active')) {
                    closeModal();
                }
                // Close guide modal if active
                if (guideModal.classList.contains('active')) {
                    closeGuideModal();
                }
                // Close settings panel if active
                if (settingsPanel.classList.contains('active')) {
                    settingsPanel.classList.remove('active');
                }
            }
        });

        // Search functionality
        const searchInput = document.getElementById('searchInput');
        searchInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                const query = searchInput.value.trim();
                if (query) {
                    // Check if it's a URL
                    if (query.includes('.') && !query.includes(' ')) {
                        const url = query.startsWith('http') ? query : `https://${query}`;
                        const sanitized = sanitizeUrl(url);
                        if (sanitized !== 'about:blank') {
                            window.location.href = sanitized;
                        }
                    } else {
                        // Search on Google
                        window.location.href = `https://www.google.com/search?q=${encodeURIComponent(query)}`;
                    }
                }
            }
        });

        // Settings functionality
        const settingsBtn = document.getElementById('settingsBtn');
        const settingsPanel = document.getElementById('settingsPanel');
        const toggleTime = document.getElementById('toggleTime');
        const toggleBookmarks = document.getElementById('toggleBookmarks');
        const toggleSearch = document.getElementById('toggleSearch');
        const timeDisplay = document.querySelector('.time-display');
        const bookmarksSection = document.querySelector('.bookmarks-section');
        const searchBox = document.querySelector('.search-box');

        // Apply saved settings
        function applySettings() {
            const lightBackgrounds = [
                'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
                'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
                'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
                'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)'
            ];
            
            document.body.style.background = settings.background;
            
            // Check if current background is light and apply theme
            const isLight = lightBackgrounds.includes(settings.background);
            if (isLight) {
                document.body.classList.add('light-theme');
                document.body.style.color = '#333';
            } else {
                document.body.classList.remove('light-theme');
                document.body.style.color = '#fff';
            }
            
            timeDisplay.style.display = settings.showTime ? 'block' : 'none';
            bookmarksSection.style.display = settings.showBookmarks ? 'block' : 'none';
            searchBox.style.display = settings.showSearch ? 'flex' : 'none';
            const weatherEl = document.getElementById('weather');
            weatherEl.style.display = settings.showWeather ? 'flex' : 'none';
            document.getElementById('weatherConfig').style.display = settings.showWeather ? 'block' : 'none';
            toggleTime.checked = settings.showTime;
            toggleBookmarks.checked = settings.showBookmarks;
            toggleSearch.checked = settings.showSearch;
            document.getElementById('toggleWeather').checked = settings.showWeather;
            document.getElementById('weatherApiKey').value = settings.weatherApiKey || '';
            document.getElementById('weatherLat').value = settings.weatherLat || '';
            document.getElementById('weatherLon').value = settings.weatherLon || '';
        }

        applySettings();

        settingsBtn.addEventListener('click', () => {
            settingsPanel.classList.toggle('active');
        });

        // Close settings panel when clicking outside (only if mousedown was also outside)
        let mouseDownTarget = null;
        document.addEventListener('mousedown', (e) => {
            mouseDownTarget = e.target;
        });
        
        document.addEventListener('mouseup', (e) => {
            if (mouseDownTarget && 
                !settingsPanel.contains(mouseDownTarget) && 
                !settingsBtn.contains(mouseDownTarget) &&
                !settingsPanel.contains(e.target) && 
                !settingsBtn.contains(e.target)) {
                settingsPanel.classList.remove('active');
            }
        });

        // Color presets
        const lightBackgrounds = [
            'linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)',
            'linear-gradient(135deg, #fa709a 0%, #fee140 100%)',
            'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
            'linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%)'
        ];
        
        document.querySelectorAll('.color-preset').forEach(preset => {
            preset.addEventListener('click', () => {
                const gradient = preset.dataset.gradient;
                const overlay = document.getElementById('gradient-overlay');
                                
                // Determine text color based on background brightness
                const isLight = lightBackgrounds.includes(gradient);
                const textColor = isLight ? '#333' : '#fff';
                document.body.style.color = textColor;
                
                // Toggle light theme class
                if (isLight) {
                    document.body.classList.add('light-theme');
                } else {
                    document.body.classList.remove('light-theme');
                }
                
                // Set new gradient on overlay
                overlay.style.background = gradient;
                
                // Fade in overlay
                requestAnimationFrame(() => {
                    overlay.style.opacity = '1';
                });
                
                // After fade completes, swap background and fade out overlay
                setTimeout(() => {
                    document.body.style.background = gradient;
                    overlay.style.opacity = '0';
                }, 900);
                
                settings.background = gradient;
                localStorage.setItem('settings', JSON.stringify(settings));
            });
        });

        // Toggle switches
        toggleTime.addEventListener('change', () => {
            settings.showTime = toggleTime.checked;
            localStorage.setItem('settings', JSON.stringify(settings));
            timeDisplay.style.display = settings.showTime ? 'block' : 'none';
        });

        toggleBookmarks.addEventListener('change', () => {
            settings.showBookmarks = toggleBookmarks.checked;
            localStorage.setItem('settings', JSON.stringify(settings));
            bookmarksSection.style.display = settings.showBookmarks ? 'block' : 'none';
        });

        toggleSearch.addEventListener('change', () => {
            settings.showSearch = toggleSearch.checked;
            localStorage.setItem('settings', JSON.stringify(settings));
            searchBox.style.display = settings.showSearch ? 'flex' : 'none';
        });

        const toggleWeather = document.getElementById('toggleWeather');
        toggleWeather.addEventListener('change', () => {
            settings.showWeather = toggleWeather.checked;
            localStorage.setItem('settings', JSON.stringify(settings));
            const weatherEl = document.getElementById('weather');
            weatherEl.style.display = settings.showWeather ? 'flex' : 'none';
            document.getElementById('weatherConfig').style.display = settings.showWeather ? 'block' : 'none';
            if (settings.showWeather) {
                loadWeather();
            }
        });

        let apiKeyTimeout;
        document.getElementById('weatherApiKey').addEventListener('input', () => {
            const apiKey = document.getElementById('weatherApiKey').value.trim();
            
            clearTimeout(apiKeyTimeout);
            
            if (apiKey.length >= 32) {
                settings.weatherApiKey = apiKey;
                localStorage.setItem('settings', JSON.stringify(settings));
                showToast('API key saved! Note: It may take a couple of minutes for the key to be activated.', 5000);
                
                if (settings.weatherLat && settings.weatherLon) {
                    localStorage.removeItem('weatherCache');
                    loadWeather();
                }
            } else if (apiKey.length > 0) {
                apiKeyTimeout = setTimeout(() => {
                    settings.weatherApiKey = apiKey;
                    localStorage.setItem('settings', JSON.stringify(settings));
                }, 500);
            }
        });

        document.getElementById('saveWeatherLocation').addEventListener('click', () => {
            const lat = document.getElementById('weatherLat').value.trim();
            const lon = document.getElementById('weatherLon').value.trim();
            
            if (lat && lon) {
                settings.weatherLat = lat;
                settings.weatherLon = lon;
                localStorage.setItem('settings', JSON.stringify(settings));
                localStorage.removeItem('weatherCache'); // Clear cache to force refresh
                loadWeather();
                showToast('Location saved! Weather will update.');
            } else {
                showToast('Please enter both latitude and longitude.');
            }
        });

        // Initial render
        renderBookmarks();

        // Cat animation
        const catContainer = document.getElementById('catAnimation');
        let catAnimation = null;
        let isAnimating = false;

        // Cat dangling parameters (tweak these!)
        const catDangleParams = {
            // Minimum time (ms) before cat can appear even with max dangling
            minAppearanceTime: 5000,
            // How much dangle intensity reduces the wait (0-1, where 1 = full reduction)
            dangleEffectiveness: 1,
            // Pixels of movement needed per "dangle unit"
            dangleSensitivity: 60,
            // How fast dangle intensity decays per second (0-1)
            dangleDecayRate: 0.01,
            // Maximum accumulated dangle intensity (caps the effect)
            maxDangleIntensity: 200,
            // Bottom portion of screen where dangling counts (0.5 = bottom half)
            activeZoneRatio: 0.4,
            // Click intensity boost (added to dangle intensity per click)
            clickIntensityBoost: 5,
            // How long cat stays visible (min-max in ms)
            stayDurationMin: 6000,
            stayDurationMax: 9000,
            // Max pixels per movement that count (prevents long sweeps from being too effective)
            maxDangleDistancePerMove: 20,
            // Radius of concentrated dangle zone (px) - fast movements within this are OK
            dangleZoneRadius: 80,
            // How many recent positions to track for zone calculation
            dangleHistorySize: 5
        };

        // Dangling state
        let dangleIntensity = 0;
        let lastCursorX = null;
        let lastCursorY = null;
        let cursorX = window.innerWidth / 2; // Track cursor X for cat positioning
        let scheduledCatTimeout = null;
        let currentScheduledTime = null;
        let actualScheduledTime = null; // The actual time when cat will appear
        let recentDanglePositions = []; // Track recent positions to detect concentrated vs spread dangles
        let debugMeterVisible = false; // Track debug meter visibility

        // Toggle debug meter visibility with Ctrl+Shift+D
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey && e.key === 'D') {
                debugMeterVisible = !debugMeterVisible;
                document.getElementById('debugMeter').style.display = debugMeterVisible ? 'block' : 'none';
                e.preventDefault();
            }
        });

        // Update debug meter
        function updateDebugMeter() {
            if (!debugMeterVisible) return; // Skip updates when hidden
            document.getElementById('dangleValue').textContent = dangleIntensity.toFixed(1);
            document.getElementById('dangleBar').style.width = 
                `${(dangleIntensity / catDangleParams.maxDangleIntensity) * 100}%`;
            
            if (currentScheduledTime && actualScheduledTime !== null && !isAnimating) {
                const elapsed = Date.now() - currentScheduledTime.startedAt;
                const originalRemaining = Math.max(0, currentScheduledTime.originalTime - elapsed);
                const actualRemaining = Math.max(0, actualScheduledTime - elapsed);
                const timeSaved = Math.max(0, originalRemaining - actualRemaining);
                
                document.getElementById('originalTime').textContent = 
                    `${(currentScheduledTime.originalTime / 1000).toFixed(1)}s`;
                document.getElementById('reducedTime').textContent = 
                    `${(actualScheduledTime / 1000).toFixed(1)}s`;
                document.getElementById('timeSaved').textContent = 
                    `${(timeSaved / 1000).toFixed(1)}s (${((timeSaved / currentScheduledTime.originalTime) * 100).toFixed(1)}%)`;
                document.getElementById('nextCatTime').textContent = 
                    `${(actualRemaining / 1000).toFixed(1)}s`;
            } else if (isAnimating) {
                document.getElementById('nextCatTime').textContent = 'CAT IS HERE!';
            }
        }

        // Update meter every 100ms
        setInterval(updateDebugMeter, 100);

        // Cat sounds
        const catSounds = [
            new Audio('cat-01.mp3'),
            new Audio('cat-02.mp3'),
            new Audio('cat-03.mp3'),
            new Audio('cat-06.mp3'),
            new Audio('cat-07.mp3'),
            new Audio('cat-08.mp3')
        ];
        let lastPlayedSounds = [];

        function playRandomCatSound() {
            // Filter out the last two sounds
            const availableSounds = catSounds.map((sound, index) => index)
                .filter(index => !lastPlayedSounds.includes(index));
            
            // Pick random from available
            const randomIndex = availableSounds[Math.floor(Math.random() * availableSounds.length)];
            const sound = catSounds[randomIndex];
            
            // Play sound
            sound.currentTime = 0;
            sound.play().catch(e => console.log('Audio play failed:', e));
            
            // Update history - keep only last 2
            lastPlayedSounds.push(randomIndex);
            if (lastPlayedSounds.length > 2) {
                lastPlayedSounds.shift();
            }
        }

        // Click summoning detection
        document.addEventListener('click', (e) => {
            const cursorY = e.clientY;
            const viewportHeight = window.innerHeight;
            
            // Only count clicks in bottom portion of screen
            if (cursorY > viewportHeight * (1 - catDangleParams.activeZoneRatio)) {
                const previousIntensity = dangleIntensity;
                dangleIntensity = Math.min(
                    catDangleParams.maxDangleIntensity,
                    dangleIntensity + catDangleParams.clickIntensityBoost
                );
                const intensityGain = dangleIntensity - previousIntensity;
                
                // Create sparks only in bottom 1/5 of screen and for significant intensity increases
                if (cursorY > viewportHeight * 0.8 && intensityGain > 3.0 && window.createDangleSparks) {
                    window.createDangleSparks(e.clientX, cursorY, intensityGain);
                }
                
                maybeRescheduleCat();
                updateDebugMeter();
            }
        });

        // Cursor dangling detection
        document.addEventListener('mousemove', (e) => {
            cursorX = e.clientX;
            const cursorY = e.clientY;
            const viewportHeight = window.innerHeight;
            
            // Only count movement in bottom portion of screen
            if (cursorY > viewportHeight * (1 - catDangleParams.activeZoneRatio)) {
                if (lastCursorX !== null && lastCursorY !== null) {
                    // Calculate movement distance
                    const dx = cursorX - lastCursorX;
                    const dy = cursorY - lastCursorY;
                    const rawDistance = Math.sqrt(dx * dx + dy * dy);
                    
                    // Track recent positions for zone detection
                    recentDanglePositions.push({ x: cursorX, y: cursorY });
                    if (recentDanglePositions.length > catDangleParams.dangleHistorySize) {
                        recentDanglePositions.shift();
                    }
                    
                    // Calculate horizontal and vertical spread to detect horizontal sweeps
                    let horizontalSpread = 0;
                    let verticalSpread = 0;
                    if (recentDanglePositions.length >= 2) {
                        let minX = recentDanglePositions[0].x;
                        let maxX = recentDanglePositions[0].x;
                        let minY = recentDanglePositions[0].y;
                        let maxY = recentDanglePositions[0].y;
                        
                        for (let i = 1; i < recentDanglePositions.length; i++) {
                            minX = Math.min(minX, recentDanglePositions[i].x);
                            maxX = Math.max(maxX, recentDanglePositions[i].x);
                            minY = Math.min(minY, recentDanglePositions[i].y);
                            maxY = Math.max(maxY, recentDanglePositions[i].y);
                        }
                        
                        horizontalSpread = maxX - minX;
                        verticalSpread = maxY - minY;
                    }
                    
                    // Ignore horizontal sweeps (where horizontal movement dominates vertical)
                    // Only count vertical dangles or concentrated wiggling
                    let distance = 0;
                    if (horizontalSpread > verticalSpread * 2) {
                        // Horizontal sweep detected - ignore completely
                        distance = 0;
                    } else if (horizontalSpread + verticalSpread <= catDangleParams.dangleZoneRadius) {
                        // Concentrated dangle - allow full distance
                        distance = rawDistance;
                    } else {
                        // Spread out vertical dangle - cap the distance
                        distance = Math.min(rawDistance, catDangleParams.maxDangleDistancePerMove);
                    }
                    
                    // Add to dangle intensity based on movement
                    const previousIntensity = dangleIntensity;
                    const dangleUnits = distance / catDangleParams.dangleSensitivity;
                    dangleIntensity = Math.min(
                        catDangleParams.maxDangleIntensity,
                        dangleIntensity + dangleUnits
                    );
                    const intensityGain = dangleIntensity - previousIntensity;
                    
                    // Create sparks only for significant intensity increases (threshold: 1.5)
                    if (intensityGain > .18 && window.createDangleSparks) {
                        window.createDangleSparks(cursorX, cursorY, intensityGain);
                    }
                    
                    // Check if we should reschedule cat appearance
                    maybeRescheduleCat();
                }
            }
            
            lastCursorX = cursorX;
            lastCursorY = cursorY;
        });

        // Decay dangle intensity over time
        setInterval(() => {
            if (dangleIntensity > 0) {
                dangleIntensity = Math.max(0, dangleIntensity - catDangleParams.dangleDecayRate * catDangleParams.maxDangleIntensity);
            }
        }, 1000);

        // Calculate new wait time based on dangle intensity
        function calculateReducedTime(originalTime) {
            const intensityRatio = dangleIntensity / catDangleParams.maxDangleIntensity;
            const reduction = originalTime * intensityRatio * catDangleParams.dangleEffectiveness;
            return Math.max(catDangleParams.minAppearanceTime, originalTime - reduction);
        }

        // Check if dangling warrants rescheduling the cat
        function maybeRescheduleCat() {
            if (!scheduledCatTimeout || !currentScheduledTime || isAnimating) return;
            
            const newTime = calculateReducedTime(currentScheduledTime.originalTime);
            const elapsed = Date.now() - currentScheduledTime.startedAt;
            const remainingCurrent = actualScheduledTime - elapsed;
            const remainingNew = newTime - elapsed;
            
            // Only reschedule if new time is shorter (even slightly)
            if (remainingNew < remainingCurrent - 100) {
                clearTimeout(scheduledCatTimeout);
                actualScheduledTime = newTime; // Update actual scheduled time
                
                if (remainingNew <= 0) {
                    // Time already passed - trigger cat immediately!
                    playCatAnimation();
                    scheduleCatAnimation();
                } else {
                    scheduledCatTimeout = setTimeout(() => {
                        playCatAnimation();
                        scheduleCatAnimation();
                    }, remainingNew);
                }
            }
        }

        const catAnimationData = {"nm":"Main Scene","ddd":0,"h":873.860252004582,"w":1217.1363115693014,"meta":{"g":"@lottiefiles/creator 1.66.2"},"layers":[{"ty":3,"nm":"Nul 1","sr":1,"st":11,"op":386,"ip":11,"hd":false,"ddd":0,"bm":0,"hasMask":false,"ao":0,"ks":{"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":0,"k":[183,183,100],"ix":6},"sk":{"a":0,"k":0},"p":{"a":1,"k":[{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[454.8384879725087,1579.860252004582],"t":11},{"s":[454.8384879725087,869.8602520045825],"t":24}],"ix":2},"r":{"a":0,"k":0,"ix":10},"sa":{"a":0,"k":0},"o":{"a":0,"k":0,"ix":11}},"ind":1},{"ty":4,"nm":"ojo der Silhouettes","sr":1,"st":0,"op":375,"ip":0,"hd":false,"ddd":0,"bm":0,"hasMask":false,"ao":0,"ks":{"a":{"a":0,"k":[48.045,48.044,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6},"sk":{"a":0,"k":0},"p":{"a":1,"k":[{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[172.758,-68.586,0],"t":30},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[166.201,-82.794,0],"t":35},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[194.616,-83.887,0],"t":62},{"s":[172.758,-68.586,0],"t":67}],"ix":2},"r":{"a":0,"k":0,"ix":10},"sa":{"a":0,"k":0},"o":{"a":0,"k":100,"ix":11}},"shapes":[{"ty":"gr","bm":0,"hd":false,"mn":"ADBE Vector Group","nm":"Groupe 1","ix":1,"cix":2,"np":2,"it":[{"ty":"sh","bm":0,"hd":false,"mn":"ADBE Vector Shape - Group","nm":"Trac√É√Ç¬© 1","ix":1,"d":1,"ks":{"a":0,"k":{"c":true,"i":[[0,-26.397],[-26.396,0],[0,26.396],[26.396,0]],"o":[[0,26.396],[26.396,-0.001],[0,-26.396],[-26.396,0]],"v":[[-47.794,0],[-0.001,47.794],[47.794,-0.001],[-0.001,-47.794]]},"ix":2}},{"ty":"fl","bm":0,"hd":false,"mn":"ADBE Vector Graphic - Fill","nm":"Fond 1","c":{"a":0,"k":[0,0,0],"ix":4},"r":1,"o":{"a":0,"k":100,"ix":5}},{"ty":"tr","a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"sk":{"a":0,"k":0,"ix":4},"p":{"a":0,"k":[48.045,48.045],"ix":2},"r":{"a":0,"k":0,"ix":6},"sa":{"a":0,"k":0,"ix":5},"o":{"a":0,"k":100,"ix":7}}]}],"ind":2,"parent":1},{"ty":4,"nm":"ojo izq Silhouettes","sr":1,"st":0,"op":375,"ip":0,"hd":false,"ddd":0,"bm":0,"hasMask":false,"ao":0,"ks":{"a":{"a":0,"k":[48.044,48.045,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6},"sk":{"a":0,"k":0},"p":{"a":1,"k":[{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[-26.17,-70.771,0],"t":30},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[-49.121,-84.978,0],"t":35},{"o":{"x":0.167,"y":0.167},"i":{"x":0.833,"y":0.833},"s":[-22.891,-84.978,0],"t":62},{"s":[-26.17,-70.771,0],"t":67}],"ix":2},"r":{"a":0,"k":0,"ix":10},"sa":{"a":0,"k":0},"o":{"a":0,"k":100,"ix":11}},"shapes":[{"ty":"gr","bm":0,"hd":false,"mn":"ADBE Vector Group","nm":"Groupe 1","ix":1,"cix":2,"np":2,"it":[{"ty":"sh","bm":0,"hd":false,"mn":"ADBE Vector Shape - Group","nm":"Trac√É√Ç¬© 1","ix":1,"d":1,"ks":{"a":0,"k":{"c":true,"i":[[0,-26.397],[-26.396,0],[0,26.396],[26.396,0]],"o":[[0,26.396],[26.396,-0.001],[0,-26.396],[-26.397,0]],"v":[[-47.794,0],[-0.001,47.794],[47.794,-0.001],[0,-47.794]]},"ix":2}},{"ty":"fl","bm":0,"hd":false,"mn":"ADBE Vector Graphic - Fill","nm":"Fond 1","c":{"a":0,"k":[0,0,0],"ix":4},"r":1,"o":{"a":0,"k":100,"ix":5}},{"ty":"tr","a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"sk":{"a":0,"k":0,"ix":4},"p":{"a":0,"k":[48.044,48.045],"ix":2},"r":{"a":0,"k":0,"ix":6},"sa":{"a":0,"k":0,"ix":5},"o":{"a":0,"k":100,"ix":7}}]}],"ind":3,"parent":1},{"ty":4,"nm":"Calque 1 Silhouettes","sr":1,"st":0,"op":375,"ip":0,"hd":false,"ddd":0,"bm":0,"hasMask":false,"ao":0,"ks":{"a":{"a":0,"k":[335.986,508.493,0],"ix":1},"s":{"a":0,"k":[100,100,100],"ix":6},"sk":{"a":0,"k":0},"p":{"a":0,"k":[-0.076,109.585,0],"ix":2},"r":{"a":0,"k":0,"ix":10},"sa":{"a":0,"k":0},"o":{"a":0,"k":100,"ix":11}},"shapes":[{"ty":"gr","bm":0,"hd":false,"mn":"ADBE Vector Group","nm":"Groupe 1","ix":1,"cix":2,"np":2,"it":[{"ty":"sh","bm":0,"hd":false,"mn":"ADBE Vector Shape - Group","nm":"Trac√É√Ç¬© 1","ix":1,"d":1,"ks":{"a":0,"k":{"c":true,"i":[[-6.088,0],[0,-6.092],[-10.139,0],[0,10.136],[-0.003,0.101],[0,0.101],[0,0],[0,6.128],[-15.059,0],[0,-8.292],[9.56,-4.428],[0,0],[0.003,-0.1],[0,-0.101],[-10.139,0],[0,10.136],[-6.088,0],[0,-6.093],[22.296,0],[7.381,7.842],[11.591,0],[0,22.3]],"o":[[6.09,0],[0,10.137],[10.14,0],[0,-0.101],[-0.003,-0.1],[0,0],[-9.56,-4.429],[0,-8.291],[15.06,0],[0,6.128],[0,0],[0,0.101],[0.003,0.101],[0,10.136],[10.14,0],[0,-6.093],[6.089,0],[0,22.3],[-11.59,0.001],[-7.381,7.842],[-22.296,0],[0,-6.093]],"v":[[-58.824,-3.369],[-47.795,7.659],[-29.412,26.043],[-11.029,7.659],[-10.999,7.363],[-11.029,7.068],[-11.029,-13.26],[-27.266,-33.089],[0,-48.102],[27.268,-33.089],[11.03,-13.26],[11.03,7.068],[10.999,7.363],[11.03,7.659],[29.412,26.042],[47.794,7.659],[58.824,-3.37],[69.853,7.659],[29.412,48.101],[0,35.329],[-29.412,48.102],[-69.853,7.66]]},"ix":2}},{"ty":"fl","bm":0,"hd":false,"mn":"ADBE Vector Graphic - Fill","nm":"Fond 1","c":{"a":0,"k":[0.749,0.3922,0.149],"ix":4},"r":1,"o":{"a":0,"k":100,"ix":5}},{"ty":"tr","a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"sk":{"a":0,"k":0,"ix":4},"p":{"a":0,"k":[407.717,410.813],"ix":2},"r":{"a":0,"k":0,"ix":6},"sa":{"a":0,"k":0,"ix":5},"o":{"a":0,"k":100,"ix":7}}]},{"ty":"gr","bm":0,"hd":false,"mn":"ADBE Vector Group","nm":"Groupe 2","ix":2,"cix":2,"np":2,"it":[{"ty":"sh","bm":0,"hd":false,"mn":"ADBE Vector Shape - Group","nm":"Trac√É√Ç¬© 1","ix":1,"d":1,"ks":{"a":0,"k":{"c":true,"i":[[0,-37.008],[-37.009,0.001],[0,37.008],[37.008,0]],"o":[[0,37.008],[37.007,0],[0,-37.008],[-37.008,0]],"v":[[-67.008,0],[0,67.008],[67.008,-0.001],[0,-67.009]]},"ix":2}},{"ty":"fl","bm":0,"hd":false,"mn":"ADBE Vector Graphic - Fill","nm":"Fond 1","c":{"a":0,"k":[1,1,1],"ix":4},"r":1,"o":{"a":0,"k":100,"ix":5}},{"ty":"tr","a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"sk":{"a":0,"k":0,"ix":4},"p":{"a":0,"k":[299.261,329.23],"ix":2},"r":{"a":0,"k":0,"ix":6},"sa":{"a":0,"k":0,"ix":5},"o":{"a":0,"k":100,"ix":7}}]},{"ty":"gr","bm":0,"hd":false,"mn":"ADBE Vector Group","nm":"Groupe 3","ix":3,"cix":2,"np":2,"it":[{"ty":"sh","bm":0,"hd":false,"mn":"ADBE Vector Shape - Group","nm":"Trac√É√Ç¬© 1","ix":1,"d":1,"ks":{"a":0,"k":{"c":true,"i":[[0,-37.008],[-37.008,0.001],[0,37.008],[37.008,0]],"o":[[0,37.008],[37.008,0],[0,-37.008],[-37.008,0]],"v":[[-67.009,0],[0,67.008],[67.009,-0.001],[0,-67.009]]},"ix":2}},{"ty":"fl","bm":0,"hd":false,"mn":"ADBE Vector Graphic - Fill","nm":"Fond 1","c":{"a":0,"k":[1,1,1],"ix":4},"r":1,"o":{"a":0,"k":100,"ix":5}},{"ty":"tr","a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"sk":{"a":0,"k":0,"ix":4},"p":{"a":0,"k":[516.174,329.229],"ix":2},"r":{"a":0,"k":0,"ix":6},"sa":{"a":0,"k":0,"ix":5},"o":{"a":0,"k":100,"ix":7}}]},{"ty":"gr","bm":0,"hd":false,"mn":"ADBE Vector Group","nm":"Groupe 4","ix":4,"cix":2,"np":2,"it":[{"ty":"sh","bm":0,"hd":false,"mn":"ADBE Vector Shape - Group","nm":"Trac√É√Ç¬© 1","ix":1,"d":1,"ks":{"a":0,"k":{"c":true,"i":[[0,0],[25.902,-23.233],[0,0],[0,0],[0,0],[0.05,-34.794],[0,0],[0.392,62.222],[31.775,0.045],[0.153,-0.002],[-0.203,-31.985],[-65.704,-8.654],[-2.494,-0.004],[-1.219,0.076],[0,0],[-22.658,50.5],[0,41.875],[0,0],[0,0],[0,0]],"o":[[0.05,-34.794],[0,0],[0,0],[0,0],[-25.836,-23.307],[0,0],[-19.955,-21.872],[-0.202,-31.831],[-0.155,0],[-31.984,0.202],[1.205,190.77],[2.539,0.336],[1.233,0.002],[0,0],[58.93,0.084],[13.454,-23.624],[0,0],[0,0],[0,0],[0,0]],"v":[[335.687,-454.416],[268.651,-484.394],[156.972,-384.219],[-1.722,-384.443],[-113.113,-484.937],[-180.235,-455.147],[-181.228,361.501],[-219.71,240.436],[-277.529,182.891],[-277.988,182.891],[-335.533,241.171],[-144.049,507.373],[-136.498,507.877],[-132.831,507.714],[181.211,508.159],[313.547,422.599],[334.642,325.355],[334.996,26.531],[334.974,26.531],[335,26.531]]},"ix":2}},{"ty":"fl","bm":0,"hd":false,"mn":"ADBE Vector Graphic - Fill","nm":"Fond 1","c":{"a":0,"k":[0.9373,0.5569,0.2706],"ix":4},"r":1,"o":{"a":0,"k":100,"ix":5}},{"ty":"tr","a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[100,100],"ix":3},"sk":{"a":0,"k":0,"ix":4},"p":{"a":0,"k":[335.986,508.494],"ix":2},"r":{"a":0,"k":0,"ix":6},"sa":{"a":0,"k":0,"ix":5},"o":{"a":0,"k":100,"ix":7}}]}],"ind":4,"parent":1}],"v":"5.7.0","fr":25,"op":77,"ip":0,"assets":[]};

        function initCatAnimation() {
            if (catAnimation) return;
            
            catAnimation = lottie.loadAnimation({
                container: catContainer,
                renderer: 'svg',
                loop: false,
                autoplay: false,
                animationData: catAnimationData
            });
        }

        function playCatAnimation() {
            if (isAnimating) return;
            isAnimating = true;

            // Position cat under cursor (clamped to 5-80% range)
            // If dangling summoned the cat, use cursor position; otherwise random
            let position;
            if (dangleIntensity > 5) {
                // Convert cursor X to percentage, clamp to safe range
                position = Math.max(5, Math.min(80, (cursorX / window.innerWidth) * 100));
            } else {
                // Fallback to random if no significant dangling
                position = Math.random() * 75 + 5;
            }
            catContainer.style.left = `${position}%`;
            catContainer.style.right = 'auto';
            catContainer.style.pointerEvents = 'auto';
            
            // Reset dangle intensity after cat appears
            dangleIntensity = 0;

            // Random duration cat stays visible
            const stayDuration = Math.random() * 
                (catDangleParams.stayDurationMax - catDangleParams.stayDurationMin) + 
                catDangleParams.stayDurationMin;
            let hideTimeout;

            // Function to hide cat
            const hideCat = (fast = false) => {
                catContainer.style.transition = fast ? 'transform 0.1s ease-in' : 'transform 2s ease-out';
                catContainer.style.transform = 'translateY(100%)';
                catContainer.style.pointerEvents = 'none';
                
                clearTimeout(hideTimeout);
                catContainer.removeEventListener('click', quickHide);
                
                setTimeout(() => {
                    isAnimating = false;
                }, fast ? 100 : 2000);
            };

            // Quick hide on click
            const quickHide = () => {
                playRandomCatSound();
                hideCat(true);
            };
            catContainer.addEventListener('click', quickHide);

            // Slide cat up (peek in)
            catContainer.style.transition = 'transform 1s ease-out';
            catContainer.style.transform = 'translateY(0)';
            
            // Play lottie animation
            catAnimation.goToAndStop(0, true);
            catAnimation.play();

            // Wait for random duration, then hide
            hideTimeout = setTimeout(() => {
                hideCat(false);
            }, stayDuration);
        }

        function scheduleCatAnimation() {
            // Random interval between 40-100 seconds
            const minTime = 40 * 1000;
            const maxTime = 100 * 1000;
            const randomTime = Math.random() * (maxTime - minTime) + minTime;
            
            // Track scheduling for dangle-based rescheduling
            currentScheduledTime = {
                originalTime: randomTime,
                startedAt: Date.now()
            };
            actualScheduledTime = randomTime; // Initialize actual scheduled time
            
            scheduledCatTimeout = setTimeout(() => {
                playCatAnimation();
                scheduleCatAnimation();
            }, randomTime);
        }

        // Initialize and start (wait 3 minutes before first appearance)
        initCatAnimation();
        setTimeout(() => {
            scheduleCatAnimation();
        },  1 * 1000);
    </script>

    <!-- Friction Spark Effect Script -->
    <script>
        // Performance-optimized spark particle system
        const canvas = document.getElementById('sparkCanvas');
        const ctx = canvas.getContext('2d', { alpha: true });
        
        // Set canvas size
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // Cursor velocity tracking
        let cursorVelocity = { x: 0, y: 0 };
        let lastCursorPos = { x: 0, y: 0 };
        let lastCursorTime = Date.now();
        
        // Track cursor movement for velocity calculation
        window.addEventListener('mousemove', (e) => {
            const currentTime = Date.now();
            const dt = Math.max(currentTime - lastCursorTime, 1) / 16; // Normalize to ~60fps
            
            // Calculate velocity
            const dx = e.clientX - lastCursorPos.x;
            const dy = e.clientY - lastCursorPos.y;
            
            // Smooth velocity with damping
            cursorVelocity.x = (dx / dt) * 0.3 + cursorVelocity.x * 0.7;
            cursorVelocity.y = (dy / dt) * 0.3 + cursorVelocity.y * 0.7;
            
            lastCursorPos = { x: e.clientX, y: e.clientY };
            lastCursorTime = currentTime;
        });

        // Particle class with realistic physics
        class Spark {
            constructor(x, y, vx, vy, isHaywire = false, cursorVel = { x: 0, y: 0 }) {
                this.x = x;
                this.y = y;
                
                // Apply cursor velocity influence to non-haywire sparks
                if (!isHaywire) {
                    const velocityInfluence = 0.05; // How much cursor velocity affects sparks
                    this.vx = vx + cursorVel.x * velocityInfluence;
                    this.vy = vy + cursorVel.y * velocityInfluence;
                } else {
                    this.vx = vx;
                    this.vy = vy;
                }
                
                this.life = 1.0;
                // Haywire sparks live twice as long (half the decay rate)
                this.decay = isHaywire 
                    ? (Math.random() * 0.0015 + 0.001) 
                    : (Math.random() * 0.003 + 0.002);
                this.size = Math.random() * 0.8 + 0.3;
                this.gravity = 0.02; // Much slower falling
                this.friction = 0.98;
                this.isHaywire = isHaywire;
                this.directionChangeCounter = 0;
                
                // Color variations for realistic sparks (more prominent yellowish)
                const colorChoice = Math.random();
                if (colorChoice < 0.3) {
                    this.color = { r: 255, g: 220 + Math.random() * 35, b: 50 + Math.random() * 30 }; // Bright yellow-orange
                } else if (colorChoice < 0.85) {
                    this.color = { r: 255, g: 250 + Math.random() * 5, b: 100 + Math.random() * 50 }; // Vivid yellow
                } else {
                    this.color = { r: 255, g: 255, b: 200 + Math.random() * 30 }; // Bright yellow-white
                }
            }

            update() {
                if (this.isHaywire) {
                    // Haywire sparks change direction randomly
                    this.directionChangeCounter++;
                    if (this.directionChangeCounter > 3) { // Change direction every few frames
                        this.directionChangeCounter = 0;
                        const randomAngle = Math.random() * Math.PI * 2;
                        const randomForce = Math.random() * 0.5;
                        this.vx += Math.cos(randomAngle) * randomForce;
                        this.vy += Math.sin(randomAngle) * randomForce;
                    }
                    // Haywire sparks have less gravity
                    this.vy += this.gravity * 0.3;
                } else {
                    // Normal sparks fall normally
                    this.vy += this.gravity;
                }
                
                this.vx *= this.friction;
                this.vy *= this.friction;
                
                this.x += this.vx;
                this.y += this.vy;
                
                // Fade out
                this.life -= this.decay;
                
                return this.life > 0;
            }

            draw() {
                const alpha = Math.pow(this.life, 0.5); // Smoother fade
                
                // Draw glow
                ctx.save();
                ctx.globalCompositeOperation = 'lighter';
                
                // Outer glow
                const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size * 4);
                gradient.addColorStop(0, `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, ${alpha * 0.8})`);
                gradient.addColorStop(0.4, `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, ${alpha * 0.3})`);
                gradient.addColorStop(1, `rgba(${this.color.r}, ${this.color.g}, ${this.color.b}, 0)`);
                
                ctx.fillStyle = gradient;
                ctx.fillRect(this.x - this.size * 4, this.y - this.size * 4, this.size * 8, this.size * 8);
                
                // Core particle
                ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * 0.6, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.restore();
            }
        }

        // Particle pool
        const particles = [];
        const MAX_PARTICLES = 150; // Limit for performance
        
        // Function to create sparks at cursor position (called from dangle detection)
        window.createDangleSparks = function(x, y, intensity) {
            // Scale spark size based on intensity
            // For small dangle intensities (0.18-2), use larger base
            // For large click intensities (3+), use smaller multiplier
            let baseSize, velocityMultiplier;
            if (intensity < 2) {
                // Dangle sparks - larger size range and more spread
                baseSize = 0.5 + (intensity * 0.8); // Size range: 0.5 to ~2.1
                velocityMultiplier = (Math.random() * 3 + 2) * (intensity * 0.8); // High spread
            } else {
                // Click sparks - smaller size range and moderate spread
                baseSize = 0.4 + (Math.min(intensity / 8, 1) * 0.6); // Size range: 0.4 to 1.0
                velocityMultiplier = (Math.random() * 2 + 1.2) * (intensity * 0.4); // Moderate spread
            }
            
            const sparkCount = Math.min(Math.floor(intensity * 3) + 1, 8); // Scale with intensity
            
            for (let i = 0; i < sparkCount; i++) {
                if (particles.length < MAX_PARTICLES) {
                    // Random direction for spark spread
                    const angle = Math.random() * Math.PI * 2;
                    
                    const vx = Math.cos(angle) * velocityMultiplier;
                    const vy = Math.sin(angle) * velocityMultiplier - Math.random() * 1; // Slight upward bias
                    
                    // Add some randomness to spawn position
                    const offsetX = (Math.random() - 0.5) * 10;
                    const offsetY = (Math.random() - 0.5) * 10;
                    
                    // 5% chance of haywire spark
                    const isHaywire = Math.random() < 0.15;
                    
                    const spark = new Spark(
                        x + offsetX,
                        y + offsetY,
                        vx,
                        vy,
                        isHaywire,
                        cursorVelocity
                    );
                    // Override size based on intensity
                    spark.size = baseSize * (Math.random() * 0.4 + 0.8); // Add slight variation
                    
                    particles.push(spark);
                }
            }
        };

        // Animation loop with performance optimization
        function animate(currentTime) {
            // Clear canvas completely (transparent)
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Update and draw particles (reverse loop for safe removal)
            for (let i = particles.length - 1; i >= 0; i--) {
                const particle = particles[i];
                
                if (!particle.update()) {
                    particles.splice(i, 1);
                } else {
                    particle.draw();
                }
            }
            
            requestAnimationFrame(animate);
        }

        // Start animation
        requestAnimationFrame(animate);
    </script>
</body>
</html>
